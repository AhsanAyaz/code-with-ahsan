---
phase: 11-admin-project-management-view-all-projects-and-delete-with-cascade-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/admin/layout.tsx
  - src/app/admin/page.tsx
  - src/app/admin/mentors/page.tsx
  - src/app/admin/mentees/page.tsx
  - src/app/admin/roadmaps/page.tsx
  - src/app/mentorship/admin/page.tsx
  - src/components/admin/AdminNavigation.tsx
  - src/components/admin/AdminAuthGate.tsx
autonomous: true

must_haves:
  truths:
    - "Navigating to /admin shows admin dashboard with shared layout (header, nav, stats)"
    - "Clicking Overview/Mentors/Mentees/Roadmaps/Projects in nav changes URL and renders correct content"
    - "Each admin route has its own URL that can be bookmarked and shared"
    - "Refreshing any admin page stays on that page (not reset to first tab)"
    - "Old /mentorship/admin redirects to /admin"
    - "Admin authentication gate works on all /admin/* routes via shared layout"
  artifacts:
    - path: "src/app/admin/layout.tsx"
      provides: "Shared admin layout with auth gate, header, navigation, and content area"
      min_lines: 50
    - path: "src/app/admin/page.tsx"
      provides: "Overview/dashboard home page extracted from monolith"
      min_lines: 30
    - path: "src/components/admin/AdminNavigation.tsx"
      provides: "Client component with active route highlighting"
      min_lines: 25
    - path: "src/components/admin/AdminAuthGate.tsx"
      provides: "Shared admin password authentication wrapper"
      min_lines: 40
    - path: "src/app/admin/mentors/page.tsx"
      provides: "All Mentors management extracted from monolith"
    - path: "src/app/admin/mentees/page.tsx"
      provides: "All Mentees management extracted from monolith"
    - path: "src/app/admin/roadmaps/page.tsx"
      provides: "Roadmaps review extracted from monolith"
  key_links:
    - from: "src/app/admin/layout.tsx"
      to: "src/components/admin/AdminAuthGate.tsx"
      via: "import and render wrapping children"
      pattern: "AdminAuthGate"
    - from: "src/components/admin/AdminNavigation.tsx"
      to: "/admin/*"
      via: "Link components with usePathname for active state"
      pattern: "usePathname.*Link.*href.*admin"
    - from: "src/app/mentorship/admin/page.tsx"
      to: "/admin"
      via: "redirect or meta refresh"
      pattern: "redirect|router.push.*admin"
---

<objective>
Refactor the admin dashboard from a 3000+ line monolithic client-side tab component to Next.js nested routes under `/admin/*`.

Purpose: Infrastructure required for proper URL navigation, lazy loading, bookmarkable URLs, and clean separation of concerns. Each admin section becomes its own route page, sharing a common layout with authentication, header, navigation, and stats.

Output: Working admin route structure at `/admin/*` with all existing functionality preserved in separate route pages.
</objective>

<execution_context>
@/Users/amu1o5/.claude/get-shit-done/workflows/execute-plan.md
@/Users/amu1o5/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-admin-project-management-view-all-projects-and-delete-with-cascade-cleanup/11-CONTEXT.md
@.planning/phases/11-admin-project-management-view-all-projects-and-delete-with-cascade-cleanup/11-RESEARCH.md
@src/app/mentorship/admin/page.tsx
@src/app/mentorship/layout.tsx
@src/app/api/mentorship/admin/auth/route.ts
@src/lib/apiClient.ts
@src/contexts/MentorshipContext.tsx
@src/contexts/AuthContext.tsx
@src/contexts/ToastContext.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create admin layout with shared authentication, header, and navigation</name>
  <files>
    src/app/admin/layout.tsx
    src/components/admin/AdminAuthGate.tsx
    src/components/admin/AdminNavigation.tsx
  </files>
  <action>
**AdminAuthGate.tsx** - Extract the admin password auth logic from the existing monolith (`src/app/mentorship/admin/page.tsx` lines 91-231 approximately). Create a client component that:
- Manages admin token in localStorage (`mentorship_admin_token`)
- Shows login form when not authenticated (password input, submit, error display)
- Validates token against `/api/mentorship/admin/auth` on mount (GET with `x-admin-token` header)
- Shows login form when not authenticated, renders `children` when authenticated
- Provides admin logout button in header area
- Uses existing AuthContext for Firebase user check (show login popup if not signed in)
- Uses existing MentorshipContext for user loading state
- Props: `children: React.ReactNode`
- Exports `useAdminAuth` hook or passes `isAdminAuthenticated` via context if needed by child pages for API calls that need the admin token header

**AdminNavigation.tsx** - Client component (per research pattern):
- Uses `usePathname()` to determine active route
- Navigation items: Overview (`/admin`), Pending Mentors (`/admin/pending`), All Mentors (`/admin/mentors`), All Mentees (`/admin/mentees`), Projects (`/admin/projects`), Roadmaps (`/admin/roadmaps`)
- Uses `Link` from next/link for each nav item
- Active state: bold text + bottom border (primary color) on exact pathname match. For `/admin` overview, use exact match only.
- Inactive: transparent border, muted text with hover state
- Style with DaisyUI tabs pattern (`tabs tabs-boxed` or horizontal link row) to match existing visual style
- Include Streamer Mode toggle button in the navigation bar (reuse existing pattern from monolith)

**layout.tsx** - Server component metadata + client wrapper:
- Set metadata: title "Admin Dashboard | Code with Ahsan"
- Wrap children in `MentorshipProvider` (same pattern as mentorship layout)
- Render `AdminAuthGate` which handles auth and shows header/nav when authenticated
- Inside AdminAuthGate (when authenticated), render:
  1. Admin header banner (warning-style bar: "ADMIN MODE - Viewing as Administrator")
  2. AdminNavigation component
  3. Main content area with children
- Container: `max-w-7xl mx-auto px-4` for content area
- Background: `bg-base-100 min-h-screen`

IMPORTANT: The AdminAuthGate must pass the admin token to child pages somehow. Options:
- Use React Context (create a small AdminTokenContext that AdminAuthGate provides)
- Or have each page read from localStorage directly (simpler, matches existing pattern)

Choose the simpler approach: each page reads admin token from localStorage directly (matches existing `ADMIN_TOKEN_KEY` pattern). AdminAuthGate only gates access, doesn't need to pass token down.
  </action>
  <verify>
- `npx next build` succeeds without TypeScript errors
- Navigate to `/admin` shows auth gate (login form)
- After admin login, admin header banner + navigation renders
- Navigation links point to correct URLs
- Active route highlighting works when manually changing URL
  </verify>
  <done>
- `/admin/layout.tsx` exists with MentorshipProvider, AdminAuthGate, header, and AdminNavigation
- `AdminAuthGate.tsx` handles login/logout with existing admin auth API
- `AdminNavigation.tsx` renders nav links with active state based on pathname
- Layout wraps all `/admin/*` routes with consistent admin chrome
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate existing admin tabs to separate route pages and set up redirect</name>
  <files>
    src/app/admin/page.tsx
    src/app/admin/pending/page.tsx
    src/app/admin/mentors/page.tsx
    src/app/admin/mentees/page.tsx
    src/app/admin/roadmaps/page.tsx
    src/app/mentorship/admin/page.tsx
  </files>
  <action>
Extract each tab's logic from `src/app/mentorship/admin/page.tsx` (3159 lines) into separate route pages. Each page is a `"use client"` component that manages its own state and data fetching.

**Overview page (`src/app/admin/page.tsx`):**
- Extract the overview tab content (stats display, alerts section)
- State: `stats`, `alerts`, `loadingStats`
- Fetch: `/api/mentorship/admin/stats` on mount (using authFetch)
- Fetch: `/api/mentorship/admin/alerts` on mount (using authFetch)
- Display: stats grid cards (total mentors, mentees, matches, etc.) + alert list
- Keep existing streamer mode support (useStreamerMode hook)

**Pending Mentors page (`src/app/admin/pending/page.tsx`):**
- Extract the pending-mentors tab content
- State: `profiles` (filtered to role=mentor, status=pending), `loadingProfiles`, `actionLoading`
- Fetch: `/api/mentorship/admin/profiles?role=mentor&status=pending` on mount
- Actions: approve, decline with reason modal
- Include the existing reviews modal for viewing mentor reviews
- Keep search functionality (useDebouncedCallback pattern from existing code)

**All Mentors page (`src/app/admin/mentors/page.tsx`):**
- Extract the all-mentors tab content including filter modal
- State: `profiles`, `loadingProfiles`, `mentorshipData`, `mentorshipSummary`, `searchQuery`, `currentPage`, `filters`, etc.
- Fetch: `/api/mentorship/admin/profiles?role=mentor` on mount
- Fetch: `/api/mentorship/admin/matches` for mentorship mapping data
- Include: filter modal (status, mentees, rating, discord filters), search, pagination
- Include: inline Discord editing, status management, delete confirmation, channel regeneration
- Include: reviews modal
- This is the largest extraction - preserve ALL existing functionality

**All Mentees page (`src/app/admin/mentees/page.tsx`):**
- Extract the all-mentees tab content
- State: `profiles` (filtered to role=mentee), `mentorshipData`, search, pagination
- Fetch: `/api/mentorship/admin/profiles?role=mentee` on mount
- Fetch: `/api/mentorship/admin/matches` for mentorship mapping
- Include: search, pagination, mentorship details, inline Discord editing

**Roadmaps page (`src/app/admin/roadmaps/page.tsx`):**
- Extract the roadmaps tab content
- State: `roadmaps`, `loadingRoadmaps`, `roadmapActionLoading`, `feedbackRoadmapId`, `feedbackText`
- Fetch: `/api/roadmaps?admin=true` on mount
- Actions: approve, request changes with feedback
- Include feedback modal

**Redirect from old path:**
Update `src/app/mentorship/admin/page.tsx` to redirect to `/admin`:
```tsx
"use client";
import { useRouter } from "next/navigation";
import { useEffect } from "react";

export default function LegacyAdminRedirect() {
  const router = useRouter();
  useEffect(() => { router.replace("/admin"); }, [router]);
  return (
    <div className="flex justify-center items-center min-h-screen">
      <span className="loading loading-spinner loading-lg"></span>
      <span className="ml-2">Redirecting to new admin dashboard...</span>
    </div>
  );
}
```

CRITICAL NOTES:
- Each page must import `authFetch` from `@/lib/apiClient` for authenticated API calls
- Each page must import `useToast` from `@/contexts/ToastContext` for notifications
- Each page must import `useStreamerMode` and anonymization helpers where profile data is shown
- Each page must import `useMentorship` to get `user` for permission checks
- The admin token for admin-specific endpoints uses `x-admin-token` header from localStorage - keep using `fetch()` (not authFetch) for `/api/mentorship/admin/*` endpoints since those use the admin token, not Firebase auth
- Shared types (`AdminStats`, `Alert`, `ProfileWithDetails`, `Review`, `MentorshipWithPartner`, `GroupedMentorship`, `MentorshipSummary`) should be defined in a shared file `src/types/admin.ts` or duplicated in each page as needed. Prefer a shared types file to avoid duplication.
- The `ADMIN_TOKEN_KEY` constant should be exported from `AdminAuthGate.tsx` so all pages can reference it
  </action>
  <verify>
- `npx next build` succeeds without TypeScript errors
- Navigate to `/admin` shows overview with stats and alerts
- Navigate to `/admin/pending` shows pending mentors with approve/decline
- Navigate to `/admin/mentors` shows all mentors with filters, search, pagination, and all actions
- Navigate to `/admin/mentees` shows all mentees with search and mentorship details
- Navigate to `/admin/roadmaps` shows pending roadmaps with approve/request-changes
- Navigate to `/mentorship/admin` redirects to `/admin`
- Browser back/forward navigates between admin routes correctly
- Refreshing any admin route stays on that route
  </verify>
  <done>
- All 5 admin route pages exist and render their respective content
- Each page fetches its own data independently on mount
- All existing admin functionality (approve, decline, edit discord, manage status, delete sessions, filter, search, paginate, review modals) is preserved
- Old admin path redirects to new `/admin` path
- No shared state between routes - each page is self-contained
  </done>
</task>

</tasks>

<verification>
1. Full build passes: `npx next build` completes without errors
2. All admin routes accessible: `/admin`, `/admin/pending`, `/admin/mentors`, `/admin/mentees`, `/admin/roadmaps`
3. Navigation highlights correct active route
4. Refresh on any route stays on that route (not reset to overview)
5. Old `/mentorship/admin` redirects to `/admin`
6. Admin auth gate prevents unauthenticated access on all routes
7. Existing admin functionality (approve/decline mentors, manage statuses, edit Discord, filter, search) works identically
</verification>

<success_criteria>
- Admin dashboard accessible at `/admin/*` with proper nested routing
- Each admin section has its own URL (/admin, /admin/pending, /admin/mentors, /admin/mentees, /admin/roadmaps)
- Shared layout provides consistent admin header, navigation, and auth gate
- All existing admin functionality preserved without regressions
- Navigation between sections updates URL and renders correct content
- Page refresh maintains current route
</success_criteria>

<output>
After completion, create `.planning/phases/11-admin-project-management-view-all-projects-and-delete-with-cascade-cleanup/11-01-SUMMARY.md`
</output>
