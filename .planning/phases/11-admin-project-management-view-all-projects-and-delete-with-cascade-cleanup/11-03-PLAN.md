---
phase: 11-admin-project-management-view-all-projects-and-delete-with-cascade-cleanup
plan: 03
type: execute
wave: 2
depends_on: ["11-01", "11-02"]
files_modified:
  - src/app/admin/projects/page.tsx
  - src/components/admin/ProjectFilters.tsx
  - src/components/admin/DeleteProjectDialog.tsx
  - src/components/admin/DeletionSummaryModal.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can view all projects at /admin/projects with cards showing title, creator, status, team info, timestamps"
    - "Admin can filter projects by status, search text, and date range"
    - "Admin can open actions dropdown on any project card and select Delete"
    - "Delete shows two-step confirmation dialog: first impact summary, then reason input"
    - "Admin must provide deletion reason (min 10 chars) before confirming delete"
    - "After successful delete, a summary modal shows what was cleaned up (members notified, applications deleted, etc.)"
    - "Project disappears from list after deletion without full page reload"
    - "Empty state shown when no projects match current filters"
  artifacts:
    - path: "src/app/admin/projects/page.tsx"
      provides: "Admin projects management route page with data fetching and card list"
      min_lines: 80
    - path: "src/components/admin/ProjectFilters.tsx"
      provides: "Client component for status, search, and date range filters"
      min_lines: 40
    - path: "src/components/admin/DeleteProjectDialog.tsx"
      provides: "Two-step delete confirmation dialog with impact summary and reason input"
      min_lines: 80
    - path: "src/components/admin/DeletionSummaryModal.tsx"
      provides: "Post-deletion modal showing detailed cleanup results"
      min_lines: 30
  key_links:
    - from: "src/app/admin/projects/page.tsx"
      to: "/api/admin/projects"
      via: "authFetch GET request on mount with filter params"
      pattern: "authFetch.*api/admin/projects"
    - from: "src/components/admin/DeleteProjectDialog.tsx"
      to: "/api/admin/projects/[id]"
      via: "authFetch DELETE with reason body"
      pattern: "authFetch.*DELETE.*api/admin/projects"
    - from: "src/app/admin/projects/page.tsx"
      to: "src/components/admin/ProjectFilters.tsx"
      via: "import and render with filter state callbacks"
      pattern: "ProjectFilters"
    - from: "src/app/admin/projects/page.tsx"
      to: "src/components/admin/DeleteProjectDialog.tsx"
      via: "conditional render when project selected for deletion"
      pattern: "DeleteProjectDialog"
---

<objective>
Create the admin projects management page at `/admin/projects` with comprehensive filtering, project cards, and the complete delete flow including two-step confirmation and post-deletion summary.

Purpose: This is the primary feature of Phase 11 - giving admins visibility into all projects with the ability to delete projects and their related data through a safe, auditable process.

Output: Working projects management page with filters, project cards, delete confirmation dialog, and deletion summary modal.
</objective>

<execution_context>
@/Users/amu1o5/.claude/get-shit-done/workflows/execute-plan.md
@/Users/amu1o5/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-admin-project-management-view-all-projects-and-delete-with-cascade-cleanup/11-CONTEXT.md
@.planning/phases/11-admin-project-management-view-all-projects-and-delete-with-cascade-cleanup/11-RESEARCH.md
@.planning/phases/11-admin-project-management-view-all-projects-and-delete-with-cascade-cleanup/11-01-SUMMARY.md
@.planning/phases/11-admin-project-management-view-all-projects-and-delete-with-cascade-cleanup/11-02-SUMMARY.md
@src/types/mentorship.ts
@src/lib/apiClient.ts
@src/contexts/ToastContext.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create projects management page with filters and project cards</name>
  <files>
    src/app/admin/projects/page.tsx
    src/components/admin/ProjectFilters.tsx
  </files>
  <action>
**ProjectFilters.tsx** - Client component for filter controls:

Props:
```typescript
interface ProjectFiltersProps {
  filters: {
    status: string;
    search: string;
    fromDate: string;
    toDate: string;
  };
  onFilterChange: (key: string, value: string) => void;
  onClearFilters: () => void;
  resultCount: number;
}
```

Layout: Horizontal filter bar with:
1. **Status dropdown** (`select` with DaisyUI `select-bordered`):
   - Options: All Statuses (empty), Pending, Active, Completed, Declined
2. **Search input** (`input` with DaisyUI `input-bordered`):
   - Placeholder: "Search by title or description..."
   - Debounced (300ms) using `useDebouncedCallback` from `use-debounce`
   - Has a search icon on the left
3. **Date range**: Two date inputs (From, To) with `input-bordered`
   - Type: `date` (native HTML date picker)
   - Labels: "From" and "To"
4. **Clear filters button**: Only visible when any filter is active
   - Text: "Clear Filters" with an X icon
5. **Result count**: Small text showing "X projects" or "X of Y projects" when filtered

Responsive: Stack vertically on mobile (`flex-col`), horizontal row on desktop (`md:flex-row`).

**Admin Projects page (`src/app/admin/projects/page.tsx`)** - Client component:

`"use client"` - manages its own state and data fetching.

**State:**
```typescript
const [projects, setProjects] = useState<EnrichedProject[]>([]);
const [loading, setLoading] = useState(true);
const [filters, setFilters] = useState({ status: '', search: '', fromDate: '', toDate: '' });
const [deleteTarget, setDeleteTarget] = useState<EnrichedProject | null>(null);
const [deletionSummary, setDeletionSummary] = useState<DeletionSummary | null>(null);
```

**EnrichedProject type** (extend Project from mentorship.ts):
```typescript
interface EnrichedProject extends Project {
  memberCount: number;
  applicationCount: number;
  invitationCount: number;
}
```

**Data fetching:**
- Fetch from `GET /api/admin/projects` using `authFetch` on mount and when filters change
- Build query string from filter state: `?status=active&search=react&fromDate=2026-01-01&toDate=2026-02-01`
- Use `useEffect` with filter dependencies (debounce the search filter value changes)
- Show loading spinner during fetch

**Page layout:**
1. **Page header**: "Projects Management" title + subtitle "View and manage all projects in the system"
2. **ProjectFilters** component with filter state
3. **Projects grid**: Cards in a single column (`grid gap-4`)

**Project card** (inline, not separate component - keeps it simple):
Each card is a `div.card.bg-base-200.shadow-md` containing:
- **Header row**: Project title (bold, large) + status badge (color-coded: pending=warning, active=success, completed=info, declined=error)
- **Creator info**: Avatar (photoURL) + display name + discord username if available
- **Description**: Truncated to 150 chars with ellipsis
- **Tech stack**: Badge row (`badge badge-sm badge-outline` per tech)
- **Stats row** (grid of small info blocks):
  - Team: `{memberCount}/{maxTeamSize}` members
  - Applications: `{applicationCount}` pending
  - Invitations: `{invitationCount}` sent
  - Difficulty badge (color-coded: beginner=success, intermediate=warning, advanced=error)
- **Timestamps row** (small muted text):
  - Created: formatted date
  - Last activity: formatted date
  - Approved/Completed: formatted date if applicable
- **GitHub link**: If present, show as external link
- **Discord channel**: If present, show channel link
- **Actions dropdown** (DaisyUI `dropdown dropdown-end`):
  - Button: Three-dot icon (vertical ellipsis) or "Actions" button
  - Menu items:
    - "View Project" -> Link to `/projects/{id}` (the public project detail page)
    - Divider
    - "Delete Project" -> Red text, triggers `setDeleteTarget(project)`
  - The dropdown should be positioned at top-right of the card

Use `format` from `date-fns` for all date formatting (pattern: "MMM d, yyyy" for dates, "MMM d, yyyy h:mm a" for timestamps).

**Empty state**: When no projects match filters, show centered message with icon: "No projects found" + "Try adjusting your filters" with a "Clear Filters" button.

**Loading state**: Show 3 skeleton cards (DaisyUI skeleton pattern: `div.skeleton.h-48` or similar).

**After deletion**: When delete completes successfully:
1. Remove the deleted project from `projects` state (optimistic removal)
2. Show deletion summary modal
3. Show success toast via `useToast()`
  </action>
  <verify>
- `npx next build` succeeds
- Navigate to `/admin/projects` shows all projects with enriched data
- Status dropdown filters projects correctly
- Search input filters by title/description after debounce
- Date range filters work
- Clear filters button resets all filters
- Each project card shows all required info (title, creator, status, team size, timestamps, tech stack)
- Actions dropdown appears with View and Delete options
- Empty state shows when no results match
  </verify>
  <done>
- `/admin/projects` page renders project cards with comprehensive information
- All 4 filter types work (status, search, date range)
- Actions dropdown on each card with Delete option
- Loading and empty states present
- Clicking Delete sets the target project for the delete dialog
  </done>
</task>

<task type="auto">
  <name>Task 2: Create delete confirmation dialog and post-deletion summary modal</name>
  <files>
    src/components/admin/DeleteProjectDialog.tsx
    src/components/admin/DeletionSummaryModal.tsx
  </files>
  <action>
**DeleteProjectDialog.tsx** - Two-step delete confirmation:

Per CONTEXT.md locked decision: Admin must provide reason. Per Claude's discretion: use two-step confirmation (impact first, then reason).

Props:
```typescript
interface DeleteProjectDialogProps {
  project: EnrichedProject;
  onConfirm: (reason: string) => Promise<void>;
  onCancel: () => void;
}
```

**Step 1: Impact Summary**
DaisyUI modal (`dialog` element with `modal` class, or use a div with `modal modal-open`):
- Title: "Delete Project" in error color (red)
- Project info card: title, creator name, status badge
- Impact summary in a warning alert box:
  - "{memberCount} team member(s) will lose access"
  - "{applicationCount} application(s) will be deleted"
  - "{invitationCount} invitation(s) will be deleted"
  - "Discord channel and all messages will be permanently deleted" (only if discordChannelId exists)
- Irreversibility warning in error alert: "This action cannot be undone. All project data will be permanently deleted."
- Buttons: "Cancel" (ghost) and "Continue to Delete" (error/red) -> advances to step 2

**Step 2: Reason Input**
- Title: "Deletion Reason Required" in error color
- Explanation text: "Please provide a reason for deleting this project. This will be logged for audit trail and sent to all affected team members via Discord."
- Textarea (`textarea textarea-bordered w-full h-32`):
  - Placeholder: "Enter deletion reason (e.g., policy violation, duplicate project, creator request)..."
  - Auto-focused when step 2 appears
- Character count hint: "Minimum 10 characters required" (show current count)
- Buttons: "Back" (ghost, returns to step 1, disabled during delete) and "Confirm Delete" (error/red, disabled when reason < 10 chars or during delete)
- Loading state: "Confirm Delete" becomes "Deleting..." with spinner when `isDeleting` is true
- Error handling: If onConfirm throws, show error message inline and re-enable the button

State management:
```typescript
const [step, setStep] = useState<'impact' | 'reason'>('impact');
const [reason, setReason] = useState('');
const [isDeleting, setIsDeleting] = useState(false);
const [error, setError] = useState('');
```

The `onConfirm` callback is called by the parent page, which:
1. Calls `authFetch('/api/admin/projects/{id}', { method: 'DELETE', body: JSON.stringify({ reason }) })`
2. On success: closes dialog, removes project from list, shows DeletionSummaryModal
3. On failure: the dialog shows the error and stays open

**DeletionSummaryModal.tsx** - Post-deletion confirmation:

Props:
```typescript
interface DeletionSummary {
  projectTitle: string;
  membersRemoved: number;
  applicationsDeleted: number;
  invitationsDeleted: number;
  discordChannelDeleted: boolean;
  membersNotified: number;
  notificationsFailed: number;
}

interface DeletionSummaryModalProps {
  summary: DeletionSummary;
  onClose: () => void;
}
```

DaisyUI modal showing:
- Title: "Project Deleted Successfully" with a success/check icon
- Project name in bold
- Cleanup summary as a list with checkmark icons:
  - "{membersRemoved} team member(s) removed"
  - "{applicationsDeleted} application(s) deleted"
  - "{invitationsDeleted} invitation(s) deleted"
  - "Discord channel deleted" (or "No Discord channel to delete" if false)
  - "{membersNotified} member(s) notified via Discord DM"
  - If `notificationsFailed > 0`: warning text "{notificationsFailed} notification(s) failed to send"
- Close button: "Done" (primary)

**Integration with the projects page:**
The parent `projects/page.tsx` handles the flow:
1. User clicks "Delete" in actions dropdown -> `setDeleteTarget(project)`
2. `DeleteProjectDialog` renders when `deleteTarget` is not null
3. On confirm: call API, on success set `setDeletionSummary(response.summary)` and `setDeleteTarget(null)`
4. `DeletionSummaryModal` renders when `deletionSummary` is not null
5. On close summary: `setDeletionSummary(null)`
6. Show toast: "Project '{title}' deleted successfully"

Wire these components into `src/app/admin/projects/page.tsx`:
- Import both components
- Add the conditional rendering at the bottom of the page JSX
- Add the delete handler function that calls the API
- On successful delete, filter the deleted project from the local state
  </action>
  <verify>
- `npx next build` succeeds
- Click Delete on a project card -> dialog shows with impact summary (step 1)
- Click "Continue to Delete" -> reason input appears (step 2)
- "Confirm Delete" disabled when reason < 10 chars
- "Back" button returns to impact summary
- After deletion, summary modal shows with cleanup details
- Closing summary modal returns to projects list (deleted project gone)
- Cancel at any step closes dialog without action
  </verify>
  <done>
- Two-step delete dialog shows impact summary then reason input
- Reason required (min 10 chars) before delete can proceed
- Loading state shown during deletion
- Error state shown if deletion fails
- Post-deletion summary modal shows all cleanup results
- Project removed from list after successful deletion
- Full delete flow integrated into projects page
  </done>
</task>

</tasks>

<verification>
1. Build passes: `npx next build` completes without errors
2. `/admin/projects` shows all projects with enriched data
3. All 4 filter types work correctly
4. Actions dropdown shows View and Delete
5. Delete flow: click Delete -> impact summary -> enter reason -> confirm -> summary modal
6. Deleted project disappears from list
7. Cancel at any step returns to projects list unchanged
8. Empty state renders when filters match nothing
</verification>

<success_criteria>
- Admin projects page shows all projects with comprehensive card information
- Filtering works for status, text search, and date range
- Delete flow requires reason and shows two-step confirmation
- Post-deletion summary shows detailed cleanup results
- Projects list updates immediately after deletion (no page refresh needed)
- All UI follows existing DaisyUI/Tailwind patterns in the codebase
</success_criteria>

<output>
After completion, create `.planning/phases/11-admin-project-management-view-all-projects-and-delete-with-cascade-cleanup/11-03-SUMMARY.md`
</output>
