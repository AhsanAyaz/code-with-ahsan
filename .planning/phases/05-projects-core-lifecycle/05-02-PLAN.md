---
phase: 05-projects-core-lifecycle
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/app/mentorship/admin/page.tsx
  - src/app/projects/new/page.tsx
autonomous: false

must_haves:
  truths:
    - "Admin sees a Projects tab in the admin dashboard"
    - "Projects tab shows pending project proposals with title, description, creator, tech stack, difficulty, GitHub link"
    - "Admin can click Approve and project moves to active status"
    - "Admin can click Decline, enter a reason, and project moves to declined status"
    - "Mentor can navigate to /projects/new and see a project creation form"
    - "Mentor fills out form and submits, project appears as pending in admin dashboard"
    - "Project creator can mark their active project as Completed from the admin Projects tab or a future UI"
  artifacts:
    - path: "src/app/mentorship/admin/page.tsx"
      provides: "Projects tab with pending proposals list, approve/decline buttons"
      contains: "projects"
    - path: "src/app/projects/new/page.tsx"
      provides: "Project creation form for mentors"
      contains: "CreateProject"
  key_links:
    - from: "src/app/mentorship/admin/page.tsx"
      to: "/api/projects"
      via: "fetch GET for listing, fetch PUT for approve/decline"
      pattern: "fetch.*api/projects"
    - from: "src/app/projects/new/page.tsx"
      to: "/api/projects"
      via: "fetch POST for project creation"
      pattern: "fetch.*api/projects"
---

<objective>
Build the frontend for project lifecycle: admin dashboard Projects tab for reviewing/approving proposals, and a project creation form for mentors.

Purpose: This connects the Phase 5 API routes to user-facing UI, completing the create -> approve -> Discord channel workflow that users interact with.

Output: Extended admin dashboard with Projects tab showing pending proposals with approve/decline actions, and a new /projects/new page with a project creation form.
</objective>

<execution_context>
@/Users/amu1o5/.claude/get-shit-done/workflows/execute-plan.md
@/Users/amu1o5/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-projects-core-lifecycle/05-RESEARCH.md
@.planning/phases/05-projects-core-lifecycle/05-01-SUMMARY.md

@src/app/mentorship/admin/page.tsx
@src/types/mentorship.ts
@src/contexts/AuthContext.tsx
@src/contexts/MentorshipContext.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Projects tab to admin dashboard</name>
  <files>src/app/mentorship/admin/page.tsx</files>
  <action>
Extend the existing admin dashboard page to include a "Projects" tab. Follow the exact patterns used by the existing tabs (overview, pending-mentors, all-mentors, all-mentees).

1. Update TabType union to include "projects":
   `type TabType = "overview" | "pending-mentors" | "all-mentors" | "all-mentees" | "projects";`

2. Add state for projects:
   ```
   const [projects, setProjects] = useState<Project[]>([]);
   const [loadingProjects, setLoadingProjects] = useState(false);
   const [projectActionLoading, setProjectActionLoading] = useState<string | null>(null);
   const [declineProjectId, setDeclineProjectId] = useState<string | null>(null);
   const [declineReason, setDeclineReason] = useState("");
   ```
   Import Project type from @/types/mentorship.

3. Add useEffect to fetch projects when "projects" tab is active:
   - Fetch from `/api/projects?status=pending` when tab activates
   - Set projects state with response data
   - Follow same loading pattern as existing tabs

4. Add handler functions:
   `handleApproveProject(projectId)`:
   - Set projectActionLoading to projectId
   - PUT /api/projects/{projectId} with { action: "approve", adminId: user.uid }
   - Show toast on success ("Project approved! Discord channel created.")
   - Remove project from local state on success
   - Show error toast on failure

   `handleDeclineProject(projectId)`:
   - Open decline modal (set declineProjectId)

   `confirmDeclineProject()`:
   - PUT /api/projects/{declineProjectId} with { action: "decline", adminId: user.uid, declineReason }
   - Show toast on success
   - Remove project from local state, close modal, reset reason

5. Add Projects tab button in the tab bar (after all-mentees tab):
   ```
   <button
     onClick={() => setActiveTab("projects")}
     className={`tab ${activeTab === "projects" ? "tab-active" : ""}`}
   >
     Projects
   </button>
   ```

6. Add Projects tab content panel (follow existing pattern of conditional rendering based on activeTab):
   - Show loading spinner when loadingProjects
   - Show "No pending project proposals" when empty
   - For each project, render a card (bg-base-200, shadow-md) showing:
     * Title as card-title
     * Description (truncated to 200 chars with ellipsis)
     * Creator name from creatorProfile.displayName
     * Tech stack as comma-separated badges
     * Difficulty as a badge (color-coded: beginner=success, intermediate=warning, advanced=error)
     * GitHub repo link if present (opens in new tab)
     * Created date formatted with date-fns format()
     * Approve button (btn-success btn-sm) and Decline button (btn-error btn-sm)
     * Show loading spinner on the button when projectActionLoading matches this project's ID

7. Add decline reason modal (use DaisyUI modal pattern consistent with existing codebase):
   - Text area for decline reason
   - Cancel and Confirm Decline buttons
   - Show when declineProjectId is set

Use the existing toast context (useToast) for success/error notifications. Use the existing AuthContext for user.uid as adminId.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no TypeScript errors.
Run `npm run build` to verify the page builds successfully.
Grep for "projects" tab in the admin page to confirm it exists.
  </verify>
  <done>
Admin dashboard has a "Projects" tab that lists pending project proposals. Each proposal card shows title, description, creator, tech stack, difficulty, and GitHub link. Admin can click Approve (triggers Discord channel creation) or Decline (opens modal for reason). Toast notifications confirm actions. Loading states prevent double-clicks.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create project creation form page</name>
  <files>src/app/projects/new/page.tsx</files>
  <action>
Create a new page at /projects/new for mentors to create project proposals. This is a client component using React 19's useActionState for form handling.

1. Create src/app/projects/new/page.tsx as a "use client" component.

2. Import AuthContext for user authentication and MentorshipContext for role checking. Import Project-related types from @/types/mentorship. Import useRouter from next/navigation.

3. Check authentication and role:
   - If not authenticated, show "Please sign in" message with link to sign in
   - If user's mentorship role is not "mentor" or status is not "accepted", show "Only accepted mentors can create projects" message
   - Use the MentorshipContext to get the current user's profile and role

4. Create form state interface:
   ```
   interface FormState {
     success?: boolean;
     error?: string;
     fieldErrors?: Record<string, string>;
     projectId?: string;
   }
   ```

5. Create async form action function:
   - Extract form fields: title, description, githubRepo, techStack (comma-separated string -> array), difficulty, maxTeamSize
   - Client-side validation: title required (3-100 chars), description required (10-2000 chars)
   - POST to /api/projects with JSON body including creatorId from auth context
   - Return { success: true, projectId } or { error: "..." }

6. Use useActionState hook:
   `const [state, formAction, isPending] = useActionState(createProjectAction, {});`

7. On success, redirect to a success state or show success message. Use router.push('/mentorship/admin') or show inline success with the project ID.

8. Render form with DaisyUI form controls (matching existing app styling):
   - Title input (text, required, input-bordered)
   - Description textarea (required, textarea-bordered, h-32)
   - GitHub Repository URL input (optional, type url, input-bordered, placeholder "https://github.com/username/repo")
   - Tech Stack input (text, input-bordered, placeholder "React, Node.js, PostgreSQL" -- comma-separated)
   - Difficulty select (select-bordered, options: Beginner, Intermediate, Advanced)
   - Max Team Size number input (min 1, max 10, default 4, input-bordered)
   - Error alert (alert-error) if state.error exists
   - Submit button (btn-primary, full width, shows loading spinner when isPending)
   - All inputs disabled when isPending

9. Add page metadata: title "Create New Project".

10. Wrap the form in a max-w-2xl mx-auto container with padding, consistent with the app's layout patterns.

NOTE: The useActionState hook in React 19 works with async functions that take (prevState, formData) as arguments. The form's action prop is set to the formAction returned by the hook.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no TypeScript errors.
Run `npm run build` to verify the page builds.
Verify the file exists at src/app/projects/new/page.tsx.
  </verify>
  <done>
/projects/new page renders a project creation form for authenticated accepted mentors. Form includes title, description, GitHub URL, tech stack, difficulty, and max team size fields. Form submission POSTs to /api/projects and shows success/error states. Non-mentors see appropriate access denied messages. Form uses React 19 useActionState for pending state management.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete project lifecycle: creation form at /projects/new, admin dashboard Projects tab with approve/decline, Discord channel creation on approval, and completion flow.</what-built>
  <how-to-verify>
1. Navigate to /projects/new as an accepted mentor
2. Fill out the form with a test project (title, description, tech stack, etc.)
3. Submit the form -- should see success state
4. Navigate to /mentorship/admin and click the "Projects" tab
5. Verify the test project appears as a pending proposal with all details
6. Click "Approve" on the project -- should see success toast about Discord channel
7. Verify a Discord channel was created in the "Projects" category (check Discord server)
8. Verify the Discord channel has a pinned message with project details
9. Test the "Decline" flow: create another test project, go to admin, click Decline, enter reason, confirm
10. Verify declined project no longer appears in pending list
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npm run build` succeeds
3. Admin dashboard shows "Projects" tab
4. Projects tab fetches and displays pending proposals
5. Approve action calls PUT with action=approve and shows success toast
6. Decline action opens modal, sends reason, shows success toast
7. /projects/new page renders form for accepted mentors
8. Form submission creates project via POST /api/projects
9. Non-mentors see access denied on creation form
</verification>

<success_criteria>
- Admin dashboard has functioning Projects tab showing pending proposals
- Each proposal shows title, description, creator, tech stack, difficulty, GitHub link
- Approve button triggers project activation + Discord channel creation
- Decline button shows reason modal and updates project status
- /projects/new renders creation form with all required fields
- Form validates inputs and submits to POST /api/projects
- Only accepted mentors can access the creation form
- Build and TypeScript compilation pass
</success_criteria>

<output>
After completion, create `.planning/phases/05-projects-core-lifecycle/05-02-SUMMARY.md`
</output>
