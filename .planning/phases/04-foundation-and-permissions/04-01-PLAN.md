---
phase: 04-foundation-and-permissions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - vitest.config.ts
  - src/types/mentorship.ts
autonomous: true

must_haves:
  truths:
    - "Project and Roadmap types importable from @/types/mentorship without breaking existing imports"
    - "Vitest runs successfully with path alias resolution"
    - "New dev dependencies installed (vitest, zod, rehype-sanitize, @firebase/rules-unit-testing)"
  artifacts:
    - path: "vitest.config.ts"
      provides: "Vitest test runner configuration with @/ alias"
      contains: "resolve"
    - path: "src/types/mentorship.ts"
      provides: "Project, ProjectMember, Roadmap, RoadmapVersion types plus status enums"
      exports: ["Project", "ProjectMember", "Roadmap", "RoadmapVersion", "ProjectStatus", "RoadmapStatus"]
  key_links:
    - from: "src/types/mentorship.ts"
      to: "existing MentorshipProfile"
      via: "same file, additive only"
      pattern: "export interface Project"
---

<objective>
Install new dependencies, configure Vitest test runner, and extend the type system with Project and Roadmap domain types.

Purpose: Establish the foundational tooling and type definitions that all other Phase 4 plans depend on. Types define the data shapes for Firestore collections, permission checks, and validation. Vitest enables testing for permission logic and security rules.
Output: Working test runner, extended type definitions in mentorship.ts
</objective>

<execution_context>
@/Users/amu1o5/.claude/get-shit-done/workflows/execute-plan.md
@/Users/amu1o5/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-foundation-and-permissions/04-RESEARCH.md
@src/types/mentorship.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and configure Vitest</name>
  <files>package.json, vitest.config.ts</files>
  <action>
    1. Install dev dependencies:
       ```
       npm install --save-dev vitest @vitest/ui @firebase/rules-unit-testing
       npm install rehype-sanitize zod
       ```
       Note: rehype-sanitize and zod are runtime deps (used in validation/sanitization code), not devDeps.

    2. Create `vitest.config.ts` at project root:
       ```typescript
       import { defineConfig } from "vitest/config";
       import path from "path";

       export default defineConfig({
         test: {
           environment: "node",
           globals: true,
           include: ["src/**/*.test.ts", "src/**/*.test.tsx"],
         },
         resolve: {
           alias: {
             "@": path.resolve(__dirname, "./src"),
           },
         },
       });
       ```

    3. Add test scripts to package.json scripts section:
       - `"test": "vitest run"`
       - `"test:watch": "vitest"`
       - `"test:ui": "vitest --ui"`

    Do NOT modify any existing scripts. Only add new ones. If a "test" script already exists, rename the new one to "test:unit".
  </action>
  <verify>Run `npx vitest run --passWithNoTests` and confirm it exits 0 with no errors. Verify the alias resolution works by checking vitest config loads without error.</verify>
  <done>Vitest configured and runnable. Dependencies installed. Test scripts in package.json.</done>
</task>

<task type="auto">
  <name>Task 2: Extend mentorship types with Project and Roadmap definitions</name>
  <files>src/types/mentorship.ts</files>
  <action>
    Add the following types to the END of `src/types/mentorship.ts`, below all existing types. Do NOT modify any existing types, interfaces, or exports. This is purely additive.

    Add these type definitions:

    ```typescript
    // ─── v2.0 Project Collaboration Types ───────────────────────

    export type ProjectStatus = "pending" | "approved" | "active" | "completed" | "archived";
    export type RoadmapStatus = "draft" | "pending" | "approved" | "active" | "archived";
    export type ProjectDifficulty = "beginner" | "intermediate" | "advanced";
    export type ProjectMemberRole = "owner" | "member";

    export interface Project {
      id: string;
      title: string;
      description: string;
      creatorId: string;
      creatorProfile?: {
        displayName: string;
        photoURL: string;
        username?: string;
      };
      status: ProjectStatus;
      githubRepo?: string;
      techStack: string[];
      difficulty: ProjectDifficulty;
      maxTeamSize: number;
      discordChannelId?: string;
      discordChannelUrl?: string;
      lastActivityAt?: Date;
      createdAt: Date;
      updatedAt: Date;
      approvedAt?: Date;
      approvedBy?: string;
    }

    export interface ProjectMember {
      id: string;
      projectId: string;
      userId: string;
      userProfile?: {
        displayName: string;
        photoURL: string;
        username?: string;
      };
      role: ProjectMemberRole;
      joinedAt: Date;
    }

    export interface Roadmap {
      id: string;
      title: string;
      description?: string;
      creatorId: string;
      creatorProfile?: {
        displayName: string;
        photoURL: string;
        username?: string;
      };
      domain: RoadmapDomain;
      difficulty: ProjectDifficulty;
      estimatedHours?: number;
      contentUrl?: string;
      content?: string;
      status: RoadmapStatus;
      version: number;
      createdAt: Date;
      updatedAt: Date;
      approvedAt?: Date;
      approvedBy?: string;
    }

    export type RoadmapDomain =
      | "web-dev"
      | "frontend"
      | "backend"
      | "ml"
      | "ai"
      | "mcp"
      | "agents"
      | "prompt-engineering";

    export interface RoadmapVersion {
      id: string;
      roadmapId: string;
      version: number;
      content: string;
      createdBy: string;
      createdAt: Date;
      changeDescription?: string;
    }
    ```

    Key decisions in these types:
    - `creatorProfile` uses a denormalized subset (displayName, photoURL, username) for efficient list rendering
    - `Project.discordChannelId/Url` for Discord integration in Phase 5
    - `Project.lastActivityAt` for stale content detection
    - `Roadmap.domain` uses union type matching the roadmap categories from requirements
    - `Roadmap.contentUrl` for Firebase Storage reference (large Markdown content)
    - `ProjectMember.id` is a composite key format: `{projectId}_{userId}`
    - Reuses `ProjectDifficulty` for both Project and Roadmap difficulty
  </action>
  <verify>
    1. Run `npx tsc --noEmit` to confirm no TypeScript compilation errors
    2. Verify existing imports still work: grep for `from "@/types/mentorship"` or `from '@/types/mentorship'` and confirm no import errors
    3. Run `npx vitest run --passWithNoTests` to confirm nothing is broken
  </verify>
  <done>
    - ProjectStatus, RoadmapStatus, ProjectDifficulty, ProjectMemberRole type aliases exported
    - Project, ProjectMember, Roadmap, RoadmapVersion interfaces exported
    - RoadmapDomain union type exported
    - All existing types unchanged and still importable
    - TypeScript compiles without errors
  </done>
</task>

</tasks>

<verification>
1. `npx vitest run --passWithNoTests` exits 0
2. `npx tsc --noEmit` exits 0
3. All new types importable: `import { Project, Roadmap, ProjectMember, RoadmapVersion } from "@/types/mentorship"`
4. Existing types unchanged: `MentorshipProfile`, `MentorshipMatch`, `MentorshipRole` still export correctly
</verification>

<success_criteria>
- Vitest configured and running
- 5 new dependencies installed (vitest, @vitest/ui, @firebase/rules-unit-testing, rehype-sanitize, zod)
- 10+ new type exports in mentorship.ts
- Zero breaking changes to existing imports
- TypeScript compilation passes
</success_criteria>

<output>
After completion, create `.planning/phases/04-foundation-and-permissions/04-01-SUMMARY.md`
</output>
