---
phase: 07-projects-demos-templates
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/mentorship.ts
  - src/app/api/projects/[id]/route.ts
  - src/app/projects/[id]/page.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Project creator can submit a demo URL and description when marking project as Completed"
    - "Demo submission form appears only when the Complete action is triggered"
    - "Demo URL is validated to accept common video/presentation platforms (YouTube, Loom, Google Drive, Vimeo)"
    - "Demo data is stored in the project document in Firestore"
    - "Completed projects display their demo information on the detail page"
  artifacts:
    - path: "src/types/mentorship.ts"
      provides: "Demo fields on Project interface (demoUrl, demoDescription)"
      contains: "demoUrl"
    - path: "src/app/api/projects/[id]/route.ts"
      provides: "Complete action accepts and stores demo data"
      contains: "demoUrl"
    - path: "src/app/projects/[id]/page.tsx"
      provides: "Demo submission modal and demo display section"
      contains: "demoUrl"
  key_links:
    - from: "src/app/projects/[id]/page.tsx"
      to: "/api/projects/[id]"
      via: "PUT request with action: complete + demoUrl + demoDescription"
      pattern: "action.*complete.*demoUrl"
    - from: "src/app/api/projects/[id]/route.ts"
      to: "Firestore projects collection"
      via: "projectRef.update with demoUrl and demoDescription"
      pattern: "demoUrl.*demoDescription"
---

<objective>
Add demo submission flow: extend Project type with demo fields, update Complete action API to accept demo data, and add demo submission UI in project detail page.

Purpose: Satisfy DEMO-01 (submit demo on completion) and DEMO-02 (demo includes video URL and description). Demos are the primary output artifact of completed projects.

Output: Demo fields on Project type, updated completion API, demo submission modal, and demo display on completed projects.
</objective>

<execution_context>
@/Users/amu1o5/.claude/get-shit-done/workflows/execute-plan.md
@/Users/amu1o5/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/types/mentorship.ts
@src/app/api/projects/[id]/route.ts
@src/app/projects/[id]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add demo fields to Project type and update Complete API</name>
  <files>src/types/mentorship.ts, src/app/api/projects/[id]/route.ts</files>
  <action>
1. In `src/types/mentorship.ts`, add the following optional fields to the existing `Project` interface (after `approvedBy?`):

```typescript
// Demo fields (populated when project is completed)
demoUrl?: string;           // URL to demo video/presentation (YouTube, Loom, Vimeo, Google Drive)
demoDescription?: string;   // Description of what the demo shows
completedAt?: Date;         // When project was completed
```

Note: `completedAt` may already be serialized from the API (the GET handler already converts it). Just ensure the type exists.

2. In `src/app/api/projects/[id]/route.ts`, update the `action === "complete"` branch:

- Extract `demoUrl` and `demoDescription` from the request body alongside `action`:
  ```typescript
  const { action, declineReason, demoUrl, demoDescription } = body;
  ```

- Add validation for demoUrl if provided:
  - Must be a valid URL (use `new URL(demoUrl)` to validate)
  - Must use HTTPS protocol
  - Optionally check that host is from common platforms: youtube.com, youtu.be, loom.com, vimeo.com, drive.google.com, docs.google.com, github.com, or allow any HTTPS URL (be permissive)
  - If validation fails, return 400 with clear error message

- Add validation for demoDescription if provided:
  - Must be a string, max 1000 characters
  - If validation fails, return 400

- Update the project document update to include demo fields:
  ```typescript
  await projectRef.update({
    status: "completed",
    completedAt: FieldValue.serverTimestamp(),
    updatedAt: FieldValue.serverTimestamp(),
    lastActivityAt: FieldValue.serverTimestamp(),
    ...(demoUrl && { demoUrl }),
    ...(demoDescription && { demoDescription }),
  });
  ```

- Demo fields are optional - a project can be completed without a demo (don't require them).
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm no type errors. Read the updated API route to verify demoUrl and demoDescription are extracted, validated, and stored.
  </verify>
  <done>Project interface has demoUrl and demoDescription fields. Complete API action accepts, validates (HTTPS URL, max 1000 char description), and stores demo data. Projects can still be completed without demo (fields optional).</done>
</task>

<task type="auto">
  <name>Task 2: Add demo submission UI and demo display</name>
  <files>src/app/projects/[id]/page.tsx</files>
  <action>
1. Add state for the demo submission flow in the existing ProjectDetailPage component:

```typescript
const [showCompleteModal, setShowCompleteModal] = useState(false);
const [demoUrl, setDemoUrl] = useState("");
const [demoDescription, setDemoDescription] = useState("");
const [completeLoading, setCompleteLoading] = useState(false);
```

2. Create a `handleCompleteProject` function:
- Instead of immediately completing the project, show the completion modal: `setShowCompleteModal(true)`

3. Create a `submitCompletion` async function:
- Set completeLoading to true
- POST to `/api/projects/${projectId}` with PUT method:
  ```typescript
  const response = await authFetch(`/api/projects/${projectId}`, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      action: "complete",
      ...(demoUrl.trim() && { demoUrl: demoUrl.trim() }),
      ...(demoDescription.trim() && { demoDescription: demoDescription.trim() }),
    }),
  });
  ```
- On success: showToast("Project completed!", "success"), close modal, refresh data
- On error: showToast with error message
- Finally: set completeLoading to false

4. Add a "Complete Project" button for the creator when project status is "active":
- Place it near the existing "Leave Project" button area (within the isCreator check)
- Style: `btn btn-success btn-sm`
- onClick: `handleCompleteProject`

5. Add the completion modal (use a DaisyUI modal pattern similar to the existing ConfirmModal usage, or a simple dialog):
```tsx
{showCompleteModal && (
  <div className="modal modal-open">
    <div className="modal-box">
      <h3 className="font-bold text-lg">Complete Project</h3>
      <p className="py-2 text-base-content/70">
        Mark this project as completed. You can optionally add a demo to showcase your work.
      </p>

      <div className="form-control mt-4">
        <label className="label">
          <span className="label-text font-semibold">Demo URL (optional)</span>
        </label>
        <input
          type="url"
          placeholder="https://youtube.com/watch?v=... or https://loom.com/share/..."
          className="input input-bordered w-full"
          value={demoUrl}
          onChange={(e) => setDemoUrl(e.target.value)}
          disabled={completeLoading}
        />
        <label className="label">
          <span className="label-text-alt">YouTube, Loom, Vimeo, Google Drive, or any HTTPS URL</span>
        </label>
      </div>

      <div className="form-control mt-2">
        <label className="label">
          <span className="label-text font-semibold">Demo Description (optional)</span>
        </label>
        <textarea
          placeholder="Describe what your demo shows, key features, and outcomes..."
          className="textarea textarea-bordered w-full h-24"
          value={demoDescription}
          onChange={(e) => setDemoDescription(e.target.value)}
          disabled={completeLoading}
          maxLength={1000}
        />
        <label className="label">
          <span className="label-text-alt">{demoDescription.length}/1000 characters</span>
        </label>
      </div>

      <div className="modal-action">
        <button
          onClick={() => setShowCompleteModal(false)}
          className="btn btn-ghost"
          disabled={completeLoading}
        >
          Cancel
        </button>
        <button
          onClick={submitCompletion}
          className="btn btn-success"
          disabled={completeLoading}
        >
          {completeLoading ? (
            <><span className="loading loading-spinner loading-sm"></span> Completing...</>
          ) : (
            "Complete Project"
          )}
        </button>
      </div>
    </div>
    <div className="modal-backdrop" onClick={() => !completeLoading && setShowCompleteModal(false)}></div>
  </div>
)}
```

6. Add a demo display section on the project detail page that shows when the project has demo data (project.status === "completed" and project.demoUrl exists):
```tsx
{project.status === "completed" && (project.demoUrl || project.demoDescription) && (
  <div>
    <h2 className="text-xl font-semibold mb-2">Project Demo</h2>
    <div className="card bg-base-200 shadow-md">
      <div className="card-body">
        {project.demoUrl && (
          <div className="mb-2">
            <a
              href={project.demoUrl}
              target="_blank"
              rel="noopener noreferrer"
              className="link link-primary font-medium"
            >
              View Demo
            </a>
          </div>
        )}
        {project.demoDescription && (
          <p className="text-base-content/80 whitespace-pre-wrap">{project.demoDescription}</p>
        )}
      </div>
    </div>
  </div>
)}
```

Place this section after the "Links" section and before the "Team Roster" section.
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm no type errors. Run `npm run build` to verify the page builds. Read the file to verify: (a) Complete button exists for creator on active projects, (b) modal opens with demo URL and description fields, (c) demo display section renders for completed projects with demo data.
  </verify>
  <done>Creator sees "Complete Project" button on active projects. Clicking opens modal with optional demo URL and description fields. Submitting calls PUT API with demo data. Completed projects show demo section with link and description. Build succeeds.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npm run build` succeeds
3. Project interface in mentorship.ts has demoUrl, demoDescription fields
4. API PUT handler for complete action extracts and stores demo fields
5. Project detail page shows Complete button for creator on active projects
6. Completion modal has demo URL and description inputs
7. Completed projects with demo data display the demo section
</verification>

<success_criteria>
- DEMO-01: Project creator can submit demo when marking project as Completed
- DEMO-02: Demo includes video/presentation URL and description (both optional to allow completing without demo)
</success_criteria>

<output>
After completion, create `.planning/phases/07-projects-demos-templates/07-05-SUMMARY.md`
</output>
