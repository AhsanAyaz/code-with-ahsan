---
phase: 03-declined-mentor-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/mentorship/admin/page.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can see a toggle control labeled 'Show declined mentors' on All Mentors tab"
    - "When toggle is OFF (default), declined mentors are hidden from the mentor list"
    - "When toggle is ON, declined mentors appear in the list"
    - "Declined mentors show a green 'Restore' button when visible"
    - "Clicking Restore changes mentor status to accepted"
    - "Restored mentors appear in the default (non-declined) list"
  artifacts:
    - path: "src/app/mentorship/admin/page.tsx"
      provides: "Declined mentor toggle and restore functionality"
      contains: "showDeclined"
  key_links:
    - from: "toggle onChange"
      to: "setShowDeclined state"
      via: "useState hook"
      pattern: "setShowDeclined\\(e\\.target\\.checked\\)"
    - from: "Restore button onClick"
      to: "handleStatusChange"
      via: "existing status update function"
      pattern: "handleStatusChange\\(.*,\\s*\"accepted\"\\)"
---

<objective>
Add declined mentor filtering and restoration to the All Mentors tab.

Purpose: Enable administrators to optionally view declined mentors and restore them to accepted status without direct database access.
Output: Modified admin page with toggle control and restore button for declined mentors.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-declined-mentor-management/03-RESEARCH.md
@src/app/mentorship/admin/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add declined mentor toggle filter</name>
  <files>src/app/mentorship/admin/page.tsx</files>
  <action>
Add state and UI for filtering declined mentors on the All Mentors tab:

1. Add state variable after existing mentorship status management state (around line 137):
   ```typescript
   // Declined mentor filter state
   const [showDeclined, setShowDeclined] = useState(false);
   ```

2. Modify the `filteredMentorshipData` computation (around line 584) to also filter by declined status when on all-mentors tab:
   ```typescript
   const filteredMentorshipData = mentorshipData.filter((item) => {
     if (!searchQuery && !showDeclined && activeTab === "all-mentors") {
       // Hide declined mentors when toggle is OFF on All Mentors tab
       if (item.profile.status === "declined") return false;
     }
     if (!searchQuery) return true;
     const query = searchQuery.toLowerCase();
     const profile = item.profile;
     const matchesSearch = (
       profile.displayName?.toLowerCase().includes(query) ||
       profile.email?.toLowerCase().includes(query) ||
       profile.discordUsername?.toLowerCase().includes(query)
     );
     // Also filter by declined status on All Mentors tab
     if (!showDeclined && activeTab === "all-mentors" && profile.status === "declined") {
       return false;
     }
     return matchesSearch;
   });
   ```

3. Add toggle control in the All Mentors tab section, immediately after the Search Input div (around line 1240) and before the Loading State section. Only show on All Mentors tab:
   ```tsx
   {/* Declined Mentor Toggle - Only on All Mentors tab */}
   {activeTab === "all-mentors" && (
     <div className="form-control">
       <label className="label cursor-pointer justify-start gap-3">
         <span className="label-text font-medium">Show declined mentors</span>
         <input
           type="checkbox"
           className="toggle toggle-primary"
           checked={showDeclined}
           onChange={(e) => setShowDeclined(e.target.checked)}
           aria-label="Toggle visibility of declined mentors in the list"
         />
       </label>
     </div>
   )}
   ```

4. Update empty state message to mention toggle when no mentors found and toggle is OFF (in the "No mentors found" section around line 1268):
   ```tsx
   <p className="text-base-content/70">
     {searchQuery
       ? "Try adjusting your search query."
       : activeTab === "all-mentors" && !showDeclined
         ? "No mentors found. Toggle 'Show declined mentors' to see declined profiles."
         : "No profiles found in this category."}
   </p>
   ```

Key patterns to follow:
- Use DaisyUI toggle component (already used elsewhere in the codebase)
- Use form-control wrapper for proper label alignment
- Include aria-label for accessibility
  </action>
  <verify>
1. TypeScript compiles without errors: `npm run build` succeeds
2. Toggle renders on All Mentors tab (visually confirm in browser)
3. Toggle does NOT render on other tabs (Pending Mentors, All Mentees)
4. With toggle OFF: declined mentors are hidden from list
5. With toggle ON: declined mentors appear in list with "Declined" badge
  </verify>
  <done>
Toggle control visible on All Mentors tab only. Default OFF hides declined mentors. Toggle ON shows declined mentors in list.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add restore button for declined mentors</name>
  <files>src/app/mentorship/admin/page.tsx</files>
  <action>
Add restore button that appears for declined mentors when the toggle is enabled:

1. Find the profile card section in the All Mentors/All Mentees tab (around line 1296, inside the `paginatedData.map((item) => ...)` loop).

2. Add a restore button after the status badge display (around line 1320, after the badges and before the email). Insert this after the `span` showing the mentee/mentor count badge:
   ```tsx
   {/* Restore button for declined mentors */}
   {activeTab === "all-mentors" && p.status === "declined" && (
     <button
       className="btn btn-success btn-sm"
       disabled={actionLoading === p.uid}
       onClick={() => handleStatusChange(p.uid, "accepted")}
     >
       {actionLoading === p.uid ? (
         <span className="loading loading-spinner loading-xs"></span>
       ) : (
         "Restore"
       )}
     </button>
   )}
   ```

This follows the exact pattern used for:
- Accept button on Pending Mentors tab (line 1043)
- Re-enable button for disabled profiles (line 1088)

The existing `handleStatusChange` function already:
- Handles status updates via PUT /api/mentorship/admin/profiles
- Updates local state after successful response
- Shows loading spinner while processing
- No additional API work needed

Key patterns:
- Use `btn btn-success btn-sm` for consistent success action styling
- Use existing `actionLoading` state to disable button during action
- Use existing `handleStatusChange(uid, "accepted")` function
- Use loading spinner pattern consistent with other buttons
  </action>
  <verify>
1. TypeScript compiles without errors: `npm run build` succeeds
2. With toggle ON, declined mentors show green "Restore" button
3. With toggle OFF, declined mentors are hidden (button not relevant)
4. Clicking Restore shows loading spinner
5. After restore completes, mentor status changes to "accepted"
6. Restored mentor disappears when toggle is turned OFF (now shows with accepted mentors)
  </verify>
  <done>
Restore button visible for declined mentors when toggle is ON. Clicking Restore changes status to accepted. Restored mentors appear in default mentor list.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **Build passes**: `npm run build` completes without errors
2. **Toggle functionality**:
   - Navigate to All Mentors tab
   - Toggle shows labeled "Show declined mentors"
   - Default state is OFF (unchecked)
3. **Filter functionality**:
   - With toggle OFF: Only non-declined mentors visible
   - With toggle ON: All mentors including declined visible
4. **Restore functionality**:
   - With toggle ON, declined mentors show "Restore" button
   - Click Restore -> mentor status changes to "accepted"
   - With toggle OFF, restored mentor now visible in default list
5. **No regression**: Other tabs (Pending Mentors, All Mentees, Overview) work unchanged
</verification>

<success_criteria>
- [ ] Toggle control renders only on All Mentors tab
- [ ] Toggle defaults to OFF (hide declined)
- [ ] Toggle ON shows declined mentors with "Declined" badge
- [ ] Restore button appears for declined mentors when visible
- [ ] Restore button calls existing handleStatusChange with "accepted"
- [ ] Restored mentors appear in non-declined list
- [ ] Build passes with no TypeScript errors
- [ ] DECL-01 (filter declined) satisfied
- [ ] DECL-02 (restore declined) satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/03-declined-mentor-management/03-01-SUMMARY.md`
</output>
