---
phase: 01-mentorship-mapping-view
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/app/mentorship/admin/page.tsx
  - package.json
autonomous: false

must_haves:
  truths:
    - "Admin can see list of mentors with their assigned mentees in All Mentors tab"
    - "Admin can see list of mentees with their assigned mentors in All Mentees tab"
    - "Mentorship details show status badge, Discord channel link, start date, last activity"
    - "Mentors/mentees with zero relationships show '0 mentees' or '0 mentors' badge"
    - "Summary stats header shows total counts"
  artifacts:
    - path: "src/app/mentorship/admin/page.tsx"
      provides: "Enhanced admin dashboard with relationship mapping"
      contains: "mentorships.map"
  key_links:
    - from: "src/app/mentorship/admin/page.tsx"
      to: "/api/mentorship/admin/matches"
      via: "fetch in useEffect"
      pattern: "fetch.*api/mentorship/admin/matches"
---

<objective>
Enhance All Mentors and All Mentees tabs to display mentor-mentee relationships with expandable sections.

Purpose: Administrators need to see the complete picture of who is mentoring whom. This adds relationship mapping to existing tabs with expandable sections showing mentee/mentor cards, status badges, Discord links, and dates.

Output: Enhanced admin page where All Mentors tab shows each mentor with their mentees, and All Mentees tab shows each mentee with their mentors.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-mentorship-mapping-view/01-CONTEXT.md
@.planning/phases/01-mentorship-mapping-view/01-RESEARCH.md
@.planning/phases/01-mentorship-mapping-view/01-01-SUMMARY.md

# Source files
@src/app/mentorship/admin/page.tsx
@src/types/mentorship.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install use-debounce and add mentorship data fetching</name>
  <files>package.json, src/app/mentorship/admin/page.tsx</files>
  <action>
1. Install use-debounce: `npm install use-debounce`

2. In admin page.tsx, add new state and types:
   - Add interface for grouped mentorship data matching API response
   - Add state: `mentorshipData`, `loadingMentorships`, `mentorshipSummary`
   - Add URL search params handling: `useSearchParams`, `usePathname`, `useRouter` from 'next/navigation'
   - Add debounced search handler using `useDebouncedCallback` from 'use-debounce'

3. Add useEffect to fetch mentorship data when:
   - Tab is 'all-mentors' -> fetch with role=mentor
   - Tab is 'all-mentees' -> fetch with role=mentee
   - Fetch from `/api/mentorship/admin/matches?role={role}`

4. Add search state that filters mentorshipData client-side by displayName, email, or discordUsername

5. Add pagination state (page number, page size of 15)
  </action>
  <verify>
Run `npm run dev` and navigate to admin page.
Switch to All Mentors tab and check browser Network tab for `/api/mentorship/admin/matches?role=mentor` call.
Verify data loads without console errors.
  </verify>
  <done>
Admin page fetches mentorship data when viewing All Mentors or All Mentees tabs
  </done>
</task>

<task type="auto">
  <name>Task 2: Render mentorship relationships in expandable sections</name>
  <files>src/app/mentorship/admin/page.tsx</files>
  <action>
Replace the existing profile list rendering in All Mentors and All Mentees tabs with relationship-aware UI:

1. Add summary stats header above the list:
   ```
   "X mentors, Y mentees, Z active mentorships"
   ```

2. Add search input with placeholder "Search by name, email, or Discord..."
   - Wire to debounced search handler
   - Filter mentorshipData client-side

3. For each mentor/mentee card:
   - Keep existing avatar, name, email, status badge layout
   - Add badge showing mentee/mentor count: "X mentees" or "X mentors"
   - Add DaisyUI collapse section for "Active Mentorships (N)"
     - Default expanded if has active mentorships
     - Inside: card for each mentorship with:
       - Partner avatar, name, email, discordUsername
       - Status badge (badge-success for active, badge-neutral for completed, badge-warning for pending, badge-error for cancelled)
       - Discord channel link (if exists) or yellow warning "No Discord channel"
       - Start date (approvedAt formatted with date-fns)
       - Last activity (lastContactAt formatted)
   - Add second collapse for "Completed Mentorships (N)" if any
     - Default collapsed
     - Same card structure

4. For mentors/mentees with zero relationships:
   - Show badge "0 mentees" or "0 mentors"
   - Collapse section shows "No mentees assigned" or "No mentors assigned"

5. Add pagination controls at bottom using DaisyUI join buttons
   - Show page numbers
   - Update URL params on page change

Loading state: Show skeleton cards (DaisyUI skeleton) while loadingMentorships is true
  </action>
  <verify>
Run `npm run dev` and test:
1. All Mentors tab shows mentors with mentee counts
2. Expanding a mentor shows their mentees with status badges
3. Discord links are clickable
4. Mentors with 0 mentees show appropriately
5. Search filters the list
6. Pagination works
  </verify>
  <done>
All Mentors and All Mentees tabs display relationships with expandable sections, search, and pagination
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Enhanced admin dashboard with mentor-mentee relationship mapping:
- All Mentors tab shows each mentor with their assigned mentees
- All Mentees tab shows each mentee with their assigned mentors
- Expandable sections with status badges, Discord links, dates
- Search and pagination
- Summary stats header
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Navigate to http://localhost:3000/mentorship/admin
3. Enter admin password when prompted
4. Click "All Mentors" tab:
   - Verify summary stats show at top
   - Verify each mentor card shows "X mentees" badge
   - Click expand on a mentor with mentees - verify mentee cards appear with status, Discord link, dates
   - Verify mentors with 0 mentees show "0 mentees" badge and empty message when expanded
5. Click "All Mentees" tab:
   - Verify each mentee shows "X mentors" badge
   - Verify relationship details appear when expanded
6. Test search: type a name and verify list filters
7. Test pagination: if enough items, verify page navigation works
  </how-to-verify>
  <resume-signal>Type "approved" if everything works, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. All Mentors tab displays mentors with their mentees in expandable sections
2. All Mentees tab displays mentees with their mentors in expandable sections
3. Each mentorship shows: status badge, Discord link, start date, last activity
4. Mentors/mentees with zero relationships appear with "0 mentees/mentors" badge
5. Summary stats header shows accurate counts
6. Search filters by name, email, Discord username
7. Pagination works with URL state
8. Loading shows skeleton cards
</verification>

<success_criteria>
- MAP-01: Admin can view a list of mentors with their assigned mentees
- MAP-02: Admin can view a list of mentees with their assigned mentors
- Mentorship data includes Discord channel links and current status
- View integrates into existing admin dashboard tabs (not new tabs)
</success_criteria>

<output>
After completion, create `.planning/phases/01-mentorship-mapping-view/01-02-SUMMARY.md`
</output>
