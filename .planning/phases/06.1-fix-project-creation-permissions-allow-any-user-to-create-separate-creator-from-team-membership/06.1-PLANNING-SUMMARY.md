# Phase 6.1 Planning Summary

**Date:** 2026-02-11
**Phase:** 06.1 - Fix project creation permissions - allow any user to create, separate creator from team membership
**Status:** Planning complete — Ready for execution

## Overview

Phase 6.1 was inserted as urgent work after completing Phase 6 UAT testing. User identified critical architectural flaw: project creation incorrectly restricted to mentors only, contradicting product vision of democratizing project creation.

## Planning Process

### Workflow Execution

1. **Phase insertion** (`/gsd:insert-phase 6.1`)
   - Decimal phase numbering to preserve roadmap sequence
   - Updated ROADMAP.md and STATE.md

2. **Research** (gsd-phase-researcher)
   - Confidence: HIGH
   - Root cause identified: `canCreateProject()` checks `isAcceptedMentor()` instead of `isAuthenticated()`
   - Secondary bug found: `canOwnerOrAdminAccess()` requires mentor role, would block non-mentor creators
   - Data model analysis confirmed creator-member separation already exists

3. **Planning** (gsd-planner)
   - Created 2 plans in 2 waves
   - Wave 1: Permissions + rules + tests
   - Wave 2: Join/leave endpoints + UI

4. **Verification** (gsd-plan-checker, iteration 1)
   - Status: ISSUES FOUND
   - 2 blockers, 2 warnings identified
   - Missing verification for public discovery filtering
   - Error message update not explicitly verified

5. **Revision** (gsd-planner)
   - Fixed all 4 issues
   - Added grep verification steps
   - Corrected test count expectations
   - Verified public discovery filtering

6. **Re-verification** (gsd-plan-checker, iteration 2)
   - Status: VERIFICATION PASSED
   - All requirements covered
   - All issues resolved

### Duration

- Total planning time: ~10 minutes
- Research: ~3 min
- Planning: ~2 min
- Verification: ~3 min
- Revision + re-verification: ~2 min

## User Requirements

1. Anyone (any authenticated user) should be able to create a project, not just mentors
2. The creator does not necessarily have to be a part of the team (a team member)
3. A creator can add themselves as a member of the project to connect to Discord channel
4. A creator should be able to leave the project as other members can
5. When a creator leaves as a member, they retain owner permissions (can still manage project, approve applications, etc.)
6. Non-member creators won't be shown in public project directories (only members are visible in team roster)
7. The system should prevent confusion between creator role (permanent ownership) and member role (temporary participation)

## Plans Created

### Plan 06.1-01: Fix permission logic, Firestore rules, and tests for any-user project creation

**Wave:** 1 (autonomous, depends on nothing)
**Files:** 4 (permissions.ts, permissions.test.ts, firestore.rules, projects/route.ts)

**Tasks:**
1. Update permission functions and Firestore rules
   - Change `canCreateProject()` from `isAcceptedMentor()` to `isAuthenticated()`
   - Change `canOwnerOrAdminAccess()` from `isAcceptedMentor() && isOwner()` to just `isOwner()`
   - Update Firestore rules and error messages
2. Update permission tests
   - Update 56 tests to reflect new behavior
   - Add 6 new test cases for non-mentor owners
   - Change 2 test expectations from false to true

### Plan 06.1-02: Creator join/leave endpoints and UI updates (dual-role badge, Join button, Create Project buttons)

**Wave:** 2 (autonomous, depends on 06.1-01)
**Files:** 6 (join/route.ts NEW, leave/route.ts, TeamRoster.tsx, page.tsx, discover/page.tsx, my/page.tsx)

**Tasks:**
1. Create join endpoint and fix leave endpoint
   - NEW: POST /api/projects/[id]/join for creator self-join
   - Remove creator-blocking logic from leave endpoint
2. Update UI for dual-role badge, Join button, and Create Project buttons
   - Filter creator from members list in TeamRoster
   - Show dual-role badge: "Creator · Member" vs "Creator"
   - Add "Join Project" button for non-member creators
   - Allow creator-members to leave
   - Update discover page: "Create a Project" button visible to ALL authenticated users
   - Update My Projects page: Add "Create Project" button in header on "Created" tab

## Key Insights

### Architectural Verification

Research revealed that **Requirement 6** (non-member creators hidden from public directories) is already met by existing architecture:
- `ProjectCard` component only displays creator profile (lines 38-50)
- Does NOT display team members
- `TeamRoster` component only used on detail page, not discovery
- Verification approach: Check existing behavior, not implement new behavior

### Critical Permission Fix

Both `canCreateProject` AND `canOwnerOrAdminAccess` must be fixed together to prevent cascading permission bug:
- If only `canCreateProject` fixed: non-mentor user can create project
- But `canOwnerOrAdminAccess` still requires mentor: creator cannot manage own project
- Fixing both enables complete workflow for non-mentor creators

### Creator-Member Separation Pattern

Architecture supports dual roles:
- **Creator (permanent):** `project.creatorId` field, immutable ownership
- **Member (temporary):** `ProjectMember` document, can join/leave
- Creator retains owner permissions even when not a member
- Discord access requires membership

## Coverage Summary

| Requirement | Plans | Status |
|-------------|-------|--------|
| 1. Any authenticated user can create | 06.1-01 | Covered |
| 2. Creator doesn't have to be member | 06.1-02 | Covered |
| 3. Creator can join to get Discord | 06.1-02 | Covered |
| 4. Creator can leave as member | 06.1-02 | Covered |
| 5. Creator retains owner permissions | 06.1-01, 06.1-02 | Covered |
| 6. Non-member creators hidden from public | 06.1-02 | Covered (verified existing) |
| 7. Prevent role confusion | 06.1-02 | Covered |

**Coverage:** 7/7 requirements ✅

## Files to be Modified

### Phase 06.1-01
- `src/lib/permissions.ts` — Update canCreateProject and canOwnerOrAdminAccess
- `src/__tests__/permissions.test.ts` — Update 56 tests
- `firestore.rules` — Update project creation rule
- `src/app/api/projects/route.ts` — Update error message

### Phase 06.1-02
- `src/app/api/projects/[id]/join/route.ts` — NEW endpoint for creator self-join
- `src/app/api/projects/[id]/leave/route.ts` — Remove creator-blocking logic
- `src/components/projects/TeamRoster.tsx` — Dual-role badge, filter creator from members
- `src/app/projects/[id]/page.tsx` — Join button for non-member creators
- `src/app/projects/discover/page.tsx` — Create Project button for all authenticated users
- `src/app/projects/my/page.tsx` — Create Project button in Created tab header

## Verification Status

**Final Verification:** PASSED ✅

All dimension checks passed:
- ✅ Requirement coverage (7/7)
- ✅ Task completeness (all sections present)
- ✅ Dependency correctness (valid linear chain)
- ✅ Key links planned (all wiring specified)
- ✅ Scope sanity (2 plans, 4 tasks, 8 files)
- ✅ Verification derivation (runnable commands)

## Next Steps

Execute Phase 6.1:
```bash
/gsd:execute-phase 06.1
```

Expected outcome:
- Any authenticated user can create projects
- Creator-member roles fully separated
- Creator can join/leave as member while retaining ownership
- UI clearly distinguishes roles with dual-badge
- 56 permission tests passing

---

*Planning completed: 2026-02-11*
*Planners: gsd-phase-researcher, gsd-planner, gsd-plan-checker*
*Verification iterations: 2 (1 revision)*
