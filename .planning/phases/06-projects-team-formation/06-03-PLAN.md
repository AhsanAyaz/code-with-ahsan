---
phase: 06-projects-team-formation
plan: 03
type: execute
wave: 3
depends_on: ["06-02"]
files_modified:
  - src/app/projects/discover/page.tsx
  - src/app/projects/[id]/page.tsx
  - src/components/projects/ProjectCard.tsx
  - src/components/projects/ProjectFilters.tsx
  - src/components/projects/ApplicationForm.tsx
  - src/components/projects/TeamRoster.tsx
autonomous: false

must_haves:
  truths:
    - "Public discovery page shows all Active projects with search and filters"
    - "Discovery page filters by tech stack and difficulty level"
    - "Discovery page search filters by project name and description"
    - "Project detail page shows full info and current team roster"
    - "Developer can apply to join project with application message"
    - "Project creator can view applications and approve/decline"
    - "Project creator can invite developer by email or Discord username"
    - "Invited developer can accept/decline invitation"
    - "Skill mismatch warning shown when appropriate"
    - "Project detail page shows application status for current user"
  artifacts:
    - path: "src/app/projects/discover/page.tsx"
      provides: "Public project discovery page with filters and search"
      min_lines: 80
    - path: "src/app/projects/[id]/page.tsx"
      provides: "Project detail page with team roster and application/invitation UI"
      min_lines: 100
    - path: "src/components/projects/ProjectCard.tsx"
      provides: "Project card for discovery grid"
      min_lines: 30
    - path: "src/components/projects/TeamRoster.tsx"
      provides: "Team roster with Creator and Member badges"
      min_lines: 40
  key_links:
    - from: "src/app/projects/discover/page.tsx"
      to: "/api/projects?status=active"
      via: "fetch in useEffect"
      pattern: "fetch.*api/projects"
    - from: "src/app/projects/[id]/page.tsx"
      to: "/api/projects/[id]/applications"
      via: "fetch for application management"
      pattern: "api/projects.*applications"
    - from: "src/app/projects/[id]/page.tsx"
      to: "/api/projects/[id]/invitations"
      via: "fetch for invitation management"
      pattern: "api/projects.*invitations"
    - from: "src/components/projects/ApplicationForm.tsx"
      to: "src/lib/validation/skillMatch.ts"
      via: "detectSkillMismatch for warnings"
      pattern: "detectSkillMismatch"
---

<objective>
Build the public project discovery page with filters/search and the project detail page with team management UI (applications, invitations, team roster).

Purpose: Enable developers to find projects to join and manage the complete team formation workflow through a user-friendly interface.
Output: Discovery page at /projects/discover, project detail page at /projects/[id], and supporting components.
</objective>

<execution_context>
@/Users/amu1o5/.claude/get-shit-done/workflows/execute-plan.md
@/Users/amu1o5/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-projects-team-formation/06-RESEARCH.md
@.planning/phases/06-projects-team-formation/06-01-SUMMARY.md
@.planning/phases/06-projects-team-formation/06-02-SUMMARY.md
@src/app/projects/page.tsx
@src/app/projects/layout.tsx
@src/app/projects/new/page.tsx
@src/types/mentorship.ts
@src/contexts/MentorshipContext.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create discovery page with filters and project detail page with team management</name>
  <files>
    src/app/projects/discover/page.tsx
    src/app/projects/[id]/page.tsx
    src/components/projects/ProjectCard.tsx
    src/components/projects/ProjectFilters.tsx
    src/components/projects/ApplicationForm.tsx
    src/components/projects/TeamRoster.tsx
  </files>
  <action>
**IMPORTANT:** The existing `/projects/page.tsx` is a static showcase page for the blog. Do NOT modify it. Create the discovery page at `/projects/discover/page.tsx`.

**1. ProjectCard.tsx** (`src/components/projects/ProjectCard.tsx`)
- "use client" component
- Props: `project: Project`
- Card with DaisyUI styling (card bg-base-200 shadow-md)
- Shows: title, description (truncated to 120 chars), tech stack badges, difficulty badge (color-coded: beginner=badge-success, intermediate=badge-warning, advanced=badge-error), creator name+avatar
- Link to `/projects/${project.id}` for full details
- Show team size: "X members" if available

**2. ProjectFilters.tsx** (`src/components/projects/ProjectFilters.tsx`)
- "use client" component
- Props: `{ searchTerm, setSearchTerm, techFilter, setTechFilter, difficultyFilter, setDifficultyFilter, availableTechs: string[] }`
- Search input (text field, input-bordered)
- Difficulty select dropdown (All / Beginner / Intermediate / Advanced)
- Tech stack multi-select: render available tech stacks as clickable badge toggles (badge-outline when inactive, badge-primary when active)
- Use DaisyUI components consistently with existing admin dashboard patterns

**3. Discovery page** (`src/app/projects/discover/page.tsx`)
- "use client" component with `export const dynamic = 'force-dynamic'`
- Fetch all active projects on mount: `GET /api/projects?status=active`
- Client-side filtering by search term (matches title and description, case-insensitive), tech stack (any match), and difficulty (exact match)
- URL sync using `useSearchParams` and `useRouter`: initialize filters from URL params on mount, debounced URL update (500ms) using `lodash.debounce` when filters change
- Responsive grid: 1 col mobile, 2 cols md, 3 cols lg
- Empty state: "No active projects found" with link to create one (if user is mentor)
- Loading state: DaisyUI spinner
- Extract unique tech stacks from all projects for filter options
- Page title: "Discover Projects"

**4. ApplicationForm.tsx** (`src/components/projects/ApplicationForm.tsx`)
- "use client" component
- Props: `{ projectId: string, project: Project, userId: string, userSkillLevel?: ProjectDifficulty, onSuccess: () => void }`
- Import and call `detectSkillMismatch(userSkillLevel, project.difficulty)` to show warning banner above form if needed (non-blocking advisory, severity-based styling: info=badge-info, warning=badge-warning)
- Textarea for application message (required, 10-500 chars)
- Submit button with loading state (React 19 useActionState pattern)
- POST to `/api/projects/${projectId}/applications` with userId and message
- On success: show success toast/message, call onSuccess callback
- On 409: show "Already applied" message
- On 403: show "Cannot apply to this project" message

**5. TeamRoster.tsx** (`src/components/projects/TeamRoster.tsx`)
- "use client" component
- Props: `{ project: Project, members: ProjectMember[], isCreator: boolean, onRemoveMember?: (memberId: string) => void }`
- Show creator first with "Creator" badge (badge-primary)
- List members with "Member" badge
- If isCreator: show remove button (X icon) next to each member (not next to creator)
- Avatar + display name + username for each person
- Count display: "Team (N members)"

**6. Project Detail Page** (`src/app/projects/[id]/page.tsx`)
- "use client" component with `export const dynamic = 'force-dynamic'`
- Fetch project data: GET `/api/projects/${id}` (need to add GET to the existing [id]/route.ts OR fetch from projects list)
- Actually, the existing PUT route at `src/app/api/projects/[id]/route.ts` may not have GET. Check if GET exists - if not, add a GET handler that returns the single project document.
- Fetch team members: Use project_members collection via a simple fetch or direct Firestore client query
- Fetch current user's application status: GET `/api/projects/${id}/applications?userId=${currentUser.uid}` or check from applications list

**Layout sections:**
- Header: project title, status badge, difficulty badge, creator info
- Description (full text)
- Tech stack badges
- GitHub repo link (if exists)
- Discord channel link (if exists, only for members/creator)

**Team section:**
- TeamRoster component
- If user is creator: show pending applications section
  - List pending applications with applicant info and message
  - Approve/Decline buttons (decline shows optional feedback input)
  - Invitation form: input for email or Discord username, invite button
- If user is NOT creator and NOT member:
  - Show "Apply to Join" section with ApplicationForm
  - OR show application status if already applied ("Your application is pending/approved/declined")
- If user has pending invitation:
  - Show invitation card with Accept/Decline buttons

Use `useMentorship()` context to get current user info. Handle unauthenticated users by showing project info without application options.

**Important implementation notes:**
- If GET /api/projects/[id] doesn't exist, ADD a GET handler to the existing `src/app/api/projects/[id]/route.ts` file that fetches and returns a single project document
- All API calls should handle errors gracefully with user-friendly messages
- Use React 19 useActionState for form submissions where appropriate
- Follow DaisyUI component patterns from existing admin dashboard
  </action>
  <verify>
- `npx tsc --noEmit` passes
- `npm run build` passes
- All 6 component/page files exist
- /projects/discover route renders without errors
- /projects/[id] route renders without errors
  </verify>
  <done>
- Discovery page shows active projects in responsive grid with search, tech filter, and difficulty filter
- URL params synced with filters via debounced updates
- Project detail page shows full project info, team roster, and role-appropriate actions
- Creator sees pending applications (approve/decline) and invitation form
- Non-creator sees application form with skill mismatch warning
- Invited users see accept/decline buttons
- Team roster shows creator + members with role badges
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete team formation system: project discovery page with search/filters, project detail page with team roster, application workflow (submit, approve, decline with feedback), invitation workflow (invite by email/Discord, accept, decline), member removal, skill mismatch warnings, Discord channel member sync.
  </what-built>
  <how-to-verify>
1. Visit /projects/discover - verify active projects display in grid with search and filter controls
2. Try searching by project name - results filter in real-time
3. Filter by difficulty level - projects filter correctly
4. Click a project card - verify /projects/[id] shows full project details
5. As a non-creator user: verify "Apply to Join" section appears with skill mismatch warning if applicable
6. Submit an application - verify success state and 409 on duplicate
7. As project creator: verify pending applications section shows the application
8. Approve an application - verify member appears in team roster
9. As project creator: try inviting by email or Discord username
10. As invited user: verify invitation appears with accept/decline options
11. As creator: remove a team member - verify they disappear from roster
12. Check responsive layout on mobile viewport
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- `npm run build` succeeds
- Discovery page accessible at /projects/discover with working filters
- Project detail page shows correct role-based UI (creator vs applicant vs member vs visitor)
- Application workflow: submit -> approve/decline -> member creation
- Invitation workflow: invite -> accept/decline -> member creation
- Discord integration: members added/removed from channel on approval/removal
- Team roster displays accurately with role badges
</verification>

<success_criteria>
- DISC-05: Public discovery page shows Active projects
- DISC-06: Filterable by tech stack and difficulty
- DISC-07: Searchable by name and description
- DISC-08: Detail page shows full info and team roster
- DISC-09: Detail page shows application status for current user
- TEAM-01: Developers browse discovery page
- TEAM-02: Developers apply with message
- TEAM-03: Creator views pending applications
- TEAM-04: Creator approves application
- TEAM-05: Creator declines with feedback
- TEAM-06: Creator invites by email or Discord
- TEAM-07: Invited developer accepts/declines
- TEAM-08: Detail page shows team with roles
- TEAM-09: Creator removes member
</success_criteria>

<output>
After completion, create `.planning/phases/06-projects-team-formation/06-03-SUMMARY.md`
</output>
