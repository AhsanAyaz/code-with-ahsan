---
phase: 08-roadmaps-creation-admin
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/app/roadmaps/new/page.tsx
  - src/app/roadmaps/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Mentor can access /roadmaps/new and see a form with title, description, domain category, difficulty, estimated hours, and Markdown editor"
    - "Markdown editor shows live preview side-by-side and toolbar for formatting"
    - "Mentor can save roadmap as draft via Save Draft button"
    - "Mentor can submit roadmap for admin review via Submit for Review button"
    - "Form shows loading state during submission and error messages on failure"
    - "Successful creation redirects or shows success state with next actions"
  artifacts:
    - path: "src/app/roadmaps/new/page.tsx"
      provides: "Roadmap creation form with MDEditor and dual submit buttons (draft/submit)"
      contains: "MDEditor"
    - path: "src/app/roadmaps/layout.tsx"
      provides: "MentorshipProvider wrapper for /roadmaps routes"
      contains: "MentorshipProvider"
  key_links:
    - from: "src/app/roadmaps/new/page.tsx"
      to: "/api/roadmaps"
      via: "authFetch POST with roadmap data"
      pattern: "authFetch.*api/roadmaps"
    - from: "src/app/roadmaps/new/page.tsx"
      to: "@uiw/react-md-editor"
      via: "dynamic import with ssr: false"
      pattern: "dynamic.*react-md-editor"
---

<objective>
Build the roadmap creation page with @uiw/react-md-editor for Markdown editing with live preview, form fields for metadata (title, domain, difficulty, estimated hours), and dual-action buttons for saving as draft or submitting for review.

Purpose: Enables mentors to create structured learning roadmaps through an intuitive editing experience. This is the primary content creation interface for the roadmaps feature.
Output: Roadmap creation page at /roadmaps/new with MDEditor integration and MentorshipProvider layout.
</objective>

<execution_context>
@/Users/amu1o5/.claude/get-shit-done/workflows/execute-plan.md
@/Users/amu1o5/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-roadmaps-creation-admin/08-RESEARCH.md

# Key references for implementation patterns
@src/app/projects/new/page.tsx
@src/app/projects/layout.tsx
@src/lib/apiClient.ts
@src/contexts/MentorshipContext.tsx
@src/types/mentorship.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @uiw/react-md-editor and create roadmaps layout</name>
  <files>
    src/app/roadmaps/layout.tsx
  </files>
  <action>
**Step 1: Install the Markdown editor package**
```bash
npm install @uiw/react-md-editor
```

**Step 2: Create `src/app/roadmaps/layout.tsx`**
Follow the exact pattern from `src/app/projects/layout.tsx`:
```typescript
import { MentorshipProvider } from "@/contexts/MentorshipContext";

export default function RoadmapsLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return <MentorshipProvider>{children}</MentorshipProvider>;
}
```

This wraps all /roadmaps/* routes with MentorshipProvider so useMentorship() works without prerender errors.
  </action>
  <verify>
Verify `@uiw/react-md-editor` is in package.json dependencies.
Verify `src/app/roadmaps/layout.tsx` exists and exports default function.
  </verify>
  <done>
@uiw/react-md-editor installed. Roadmaps layout provides MentorshipProvider context.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create roadmap creation page with Markdown editor</name>
  <files>src/app/roadmaps/new/page.tsx</files>
  <action>
Create `src/app/roadmaps/new/page.tsx` following the pattern from `src/app/projects/new/page.tsx` but adapted for roadmaps.

**File structure:**
```
"use client";
// imports
export const dynamic = 'force-dynamic';
// FormState interface
// Page component
```

**Imports:**
- `useState, useActionState` from "react"
- `useMentorship` from "@/contexts/MentorshipContext"
- `useRouter` from "next/navigation"
- `Link` from "next/link"
- `authFetch` from "@/lib/apiClient"
- Dynamic import for MDEditor: `const MDEditor = dynamic(() => import("@uiw/react-md-editor"), { ssr: false });`
- `dynamic` from "next/dynamic"
- Types: `RoadmapDomain, ProjectDifficulty` from "@/types/mentorship"

**Constants:**
```typescript
const DOMAIN_OPTIONS: { value: RoadmapDomain; label: string }[] = [
  { value: "web-dev", label: "Web Development" },
  { value: "frontend", label: "Frontend" },
  { value: "backend", label: "Backend" },
  { value: "ml", label: "Machine Learning" },
  { value: "ai", label: "AI" },
  { value: "mcp", label: "MCP Servers" },
  { value: "agents", label: "AI Agents" },
  { value: "prompt-engineering", label: "Prompt Engineering" },
];

const DIFFICULTY_OPTIONS: { value: ProjectDifficulty; label: string }[] = [
  { value: "beginner", label: "Beginner" },
  { value: "intermediate", label: "Intermediate" },
  { value: "advanced", label: "Advanced" },
];
```

**Component state (controlled inputs, same pattern as projects/new):**
- `title` (string, empty)
- `description` (string, empty)
- `domain` (RoadmapDomain, "web-dev")
- `difficulty` (ProjectDifficulty, "intermediate")
- `estimatedHours` (string, empty - parse to number on submit)
- `content` (string, empty - bound to MDEditor)
- `submitAction` ("draft" | "submit", "draft") - tracks which button was pressed

**Form action function `createRoadmapAction(prevState: FormState, formData: FormData)`:**
1. Client-side validation:
   - title: 3-100 chars required
   - content: 50+ chars required (tell user "Roadmap content must be at least 50 characters")
   - domain: must be valid RoadmapDomain
   - difficulty: must be valid
   - estimatedHours: if provided, must be positive number <= 1000
2. POST to `/api/roadmaps` via authFetch with JSON body:
   ```
   { title, description, domain, difficulty, estimatedHours: parsed number or undefined, content }
   ```
3. On success, if `submitAction === "submit"`:
   - Make a second PUT call to `/api/roadmaps/${data.id}` with `{ action: "submit" }` to transition from draft to pending
4. Return `{ success: true, roadmapId: data.id }` on success
5. Handle errors and return `{ error: message }` or `{ fieldErrors: {...} }`

**useActionState setup:**
```typescript
const [state, formAction, isPending] = useActionState(createRoadmapAction, {});
```

**Auth gate:** If loading, show loading spinner. If not authenticated (`!user`), show "Please sign in" message with link. If user exists but profile check shows they're not an accepted mentor (`profile?.role !== "mentor" || profile?.status !== "accepted"`), show "Only accepted mentors can create roadmaps" message.

**Form layout (DaisyUI classes, follow projects/new pattern):**
```
<div className="max-w-4xl mx-auto p-4 sm:p-6">
  <h1>Create Roadmap</h1>
  <p>Share your expertise by creating a learning roadmap...</p>

  {state.error && <div className="alert alert-error">...</div>}

  {state.success ? (
    // Success state with link to dashboard and "Create Another" button
  ) : (
    <form action={formAction} className="space-y-6">
      // Title input (text, required)
      // Description textarea (optional, max 500 chars, "Brief summary for listings")
      // Domain select dropdown (required, from DOMAIN_OPTIONS)
      // Difficulty select dropdown (required, from DIFFICULTY_OPTIONS)
      // Estimated Hours input (number, optional, placeholder "e.g., 40")

      // Markdown Editor section:
      <div className="form-control">
        <label className="label">
          <span className="label-text font-semibold">Roadmap Content *</span>
        </label>
        <div data-color-mode="light">
          <MDEditor
            value={content}
            onChange={(val) => setContent(val || "")}
            height={500}
            preview="live"
          />
        </div>
        <label className="label">
          <span className="label-text-alt">Supports GitHub Flavored Markdown</span>
          <span className="label-text-alt">{content.length} characters</span>
        </label>
      </div>

      // Action buttons row:
      <div className="flex gap-3 justify-end">
        <button type="submit"
          className="btn btn-outline"
          disabled={isPending}
          onClick={() => setSubmitAction("draft")}>
          {isPending && submitAction === "draft" ? "Saving..." : "Save as Draft"}
        </button>
        <button type="submit"
          className="btn btn-primary"
          disabled={isPending}
          onClick={() => setSubmitAction("submit")}>
          {isPending && submitAction === "submit" ? "Submitting..." : "Submit for Review"}
        </button>
      </div>
    </form>
  )}
</div>
```

**Field error display:** Show inline errors below each field using `state.fieldErrors?.fieldName` (same pattern as projects/new).

**Hidden input for content:** Since MDEditor is not a native form element, include a hidden input or pass content directly through the action function using the controlled state variable (same approach as projects/new which uses controlled state instead of formData).

**Success state:** Show a card with:
- "Roadmap Created!" (or "Roadmap Submitted!" if submitted for review)
- Message explaining next step (draft saved vs submitted for review)
- Link back to dashboard
- "Create Another Roadmap" button

Use DaisyUI form classes: `form-control`, `label`, `label-text`, `input`, `input-bordered`, `select`, `select-bordered`, `textarea`, `textarea-bordered`, `btn`, `btn-primary`, `btn-outline`, `alert`, `alert-error`, `alert-success`.
  </action>
  <verify>
Run `npm run build` to verify no build errors (SSR, prerender, TypeScript).
Verify MDEditor is loaded via dynamic import with ssr: false.
Verify form has both "Save as Draft" and "Submit for Review" buttons.
  </verify>
  <done>
Roadmap creation page at /roadmaps/new with:
- Form fields for title, description, domain, difficulty, estimated hours
- @uiw/react-md-editor with live preview for content editing
- Save as Draft button (creates draft roadmap)
- Submit for Review button (creates draft then transitions to pending)
- Loading states, error handling, success state
- Auth gate for accepted mentors only
  </done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds without errors
2. `@uiw/react-md-editor` in package.json dependencies
3. `/roadmaps/new` page renders with MDEditor (no SSR errors from dynamic import)
4. Form validates required fields before submission
5. Save as Draft creates roadmap with status "draft"
6. Submit for Review creates roadmap then submits (status "pending")
7. MentorshipProvider layout wraps /roadmaps routes
8. Auth gate prevents non-mentors from accessing the form
</verification>

<success_criteria>
- Mentor can navigate to /roadmaps/new and see a complete roadmap creation form
- Markdown editor provides live preview and toolbar for formatting
- Mentor can save roadmap as draft without submitting for review
- Mentor can submit roadmap directly for admin review
- Form shows validation errors for missing/invalid fields
- Loading states prevent double submission
- Success state provides clear next steps
</success_criteria>

<output>
After completion, create `.planning/phases/08-roadmaps-creation-admin/08-02-SUMMARY.md`
</output>
